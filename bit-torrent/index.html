<!DOCTYPE html>
<html lang="en-us">
<title>Bit Torrent | heapdump</title>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.59.0" />
<meta name="description" content="Made by &lt;a href=&#34;&#34;&gt;heapdump&lt;/a&gt;">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://heapdump.cc/css/index.css">
<link rel="stylesheet" href="https://heapdump.cc/css/classes.css">
<link rel="stylesheet" href="https://heapdump.cc/css/sidebar.css" media="screen and (min-width: 70em)">
<link rel="canonical" href="https://heapdump.cc/bit-torrent/">
<link rel="alternate" type="application/rss+xml" href="" title="heapdump">

<body>

<header class="icons">
  
  
    <nav>
    
      <a href="/" >
        
          
          
          <span class="hidden"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"/></svg></span>
          <span >Home</span>
        
      </a>
    
      <a href="/about/" >
        
          
          
          <span class="hidden"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M528 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h480c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-352 96c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zm112 236.8c0 10.6-10 19.2-22.4 19.2H86.4C74 384 64 375.4 64 364.8v-19.2c0-31.8 30.1-57.6 67.2-57.6h5c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h5c37.1 0 67.2 25.8 67.2 57.6v19.2zM512 312c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16zm0-64c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16zm0-64c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16z"/></svg></span>
          <span >About</span>
        
      </a>
    
    </nav>
  
    <nav>
    
      <a href="https://github.com/chaogu" >
        
          
          
          <span ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
          <span class="hidden">Github</span>
        
      </a>
    
      <a href="/index.xml" >
        
          
          
          <span ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"/></svg></span>
          <span class="hidden">Subscribe</span>
        
      </a>
    
    </nav>
  
  
    <div class="hidden description">Made by <a href="">heapdump</a></div>
  
</header>

<article>
  <header>
    <h1>Bit Torrent</h1>
    <time datetime="2019-11-04T10:53:34&#43;08:00">November 04, 2019</time>
  </header>
  

<p>本文翻译自《<a href="https://skerritt.blog/bit-torrent/">How Does BitTorrent Work? a Plain English Guide</a> 》，由于</p>

<h1 id="bittorrent如何工作">BitTorrent如何工作</h1>

<p>BitTorrent是用于传输大文件的最常见协议之一。2013年2月，BitTorrent占全球所有带宽的3.35％，占所有文件共享带宽（6％）的一半以上。
本文不谈论如何使用BitTorrent上传下载内容，也不讨论哪个客户端是最好的，只是深入探讨它的技术层面的内容。任何没有网络或BitTorrent基础知识都任都可以读懂这篇文章。
让我们开始吧！</p>

<h1 id="目录">目录</h1>

<p>1、谁创建了BitTorrent？
2、BitTorrent与客户服务器端下载对比
3、概述
4、什么是Torrent描述文件
5、of BitTorrent的片段选择算法
6、Sub什么是子件和件选择算法？
6.1、严格政策
6.2、抢先
6.3、随机第一部分
6.4、残局模式
7、Using使用针锋相对的资源分配
8窒息算法
9乐观
10、反突
11、If如果仅上传，该怎么办？
12、什么是追踪器？
12.1、公共追踪器
12.2、私人追踪器
12.3、多轨洪流
13、磁链-无轨洪流
14、分布式哈希表
15、路由表
16、Bit攻击BitTorrent</p>

<h2 id="谁创建了bittorrent">谁创建了BitTorrent</h2>

<p>布萊姆·科亨（<a href="https://en.wikipedia.org/wiki/Bram_Cohen">Bram Cohen</a>）在2001年发明了BitTorrent协议,他用Python编写了第一个客户端实现。在2002年夏天，他收集了免费的色情内容，以吸引测试用户。</p>

<h2 id="bittorrent与客户服务器端下载对比">BitTorrent与客户服务器端下载对比</h2>

<p>在传统下载中，服务器上载文件，而客户端下载文件。</p>

<p>对于热门文件，这不是很有效。
1、500个人同时下载同一文件会使服务器承受巨大的压力,从而限制上行速度，结果客户端无法快速下载文件。
2、客户端服务器模式要花很多钱，我们支付的服务器的费用会随着文件的受欢迎程度而增加。
3、它是集中式的，如果系统死了，该文件就不再存在了，也就没有人可以下载它。</p>

<p>BitTorrent旨在解决这些问题。</p>

<p>| 客户服务器模式               |   BitTorrent                  |<br />
|&mdash;&mdash;&mdash;&mdash;&mdash;-               | &mdash;&mdash;&mdash;&mdash;                  |
| 集中式                       | 分布式                       |
| 热门文件会造成服务端产生压力    | 热门文件不会造成任何压力      |
| 花费大量的钱，花费多少取决于文件有多少人下载    |花费并不会随着文件热门程度增长|</p>

<p>在对等网络中，每个对等点都连接到网络中的每个其他对等点。
<img src="/images/Peer-to-peer-network.svg" alt="对等网络" />
半集中式对等网络拥有一个或多个对等网络，其权限比大多数对等网络更高。
<img src="/images/Peer-to-peer-network-centralised.svg" alt="半集中式对等网络" /></p>

<h2 id="概述">概述</h2>

<p>BitTorrent是一种共享文件的方式，通常用于大型文件。BitTorrent是共享文件（例如服务器）的单个源的替代方法。BitTorrent可以有效地在较低带宽上工作。</p>

<p>BitTorrent客户端的第一个版本没有搜索引擎，也没有对等交换，想要上载文件的用户必须创建一个小的torrent描述符文件，然后将其上传到torrent索引站点。</p>

<p>当用户想要共享文件时，他们会播种文件。该用户称为播种机。他们将torrent描述符文件上传到交易所（我们稍后再讨论）。任何想要下载该文件的人都将下载该种子描述符。
<img src="/image/ClientServer-1.png" alt="上传描述符文件" /></p>

<p>我们称呼那些下载同行的人。他们的洪流客户端将连接到跟踪器（稍后讨论），并且跟踪器将向他们发送群集中其他种子和对等方的IP地址列表。该群是所有电脑相关的一定洪流。</p>

<p>torrent描述符文件包含我们正在下载的文件上的跟踪器和元数据的列表。
<img src="/image/ClientServer--2-.png" alt="从跟踪器下载元数据列表" /></p>

<p>对等方将连接到种子并下载文件的一部分。</p>

<p><img src="/image/peer-to-peer-bit-torrent.png" alt="连接到对等方下载文件" /></p>

<p>对等方完成下载后，它们可以充当种子。虽然，可以在下载的同时充当种子（这是很常见的）。</p>

<p>种子将文件共享给同级后，该同级将充当种子。在BitTorrent中，取代了只有一台服务器来上传文件的客户端-服务器模型，多个人可以上传同一文件。</p>

<p>BitTorrent将文件分成称为块的块，每个块都有一定大小。有时是256KB，有时是1MB。当每个同龄人收到一块时，它们就成为其他同龄人的种子。</p>

<p>使用BitTorrent，我们没有一个单一的下载源。我们可以从您的祖国下载一些作品，然后从遥远的国家下载您祖国不拥有的一些作品。</p>

<p>该协议对片段进行哈希处理，以确保没有种子被篡改原始文件。然后将散列存储在跟踪器的种子描述符中。</p>

<p>这就是BitTorrent在高水平上的工作方式。现在我们将详细介绍。我们旨在回答以下问题：</p>

<ul>
<li>如果对等方仅下载但从未上传，该怎么办？</li>
<li>我们从谁下载或上传到谁？</li>
<li>什么是磁链？</li>
<li>什么是洪流描述符？</li>
<li>使用什么哈希算法？</li>
<li>BitTorrent如何选择要下载的部分？
以及更多。</li>
</ul>

<h2 id="什么是torrent描述文件">什么是Torrent描述文件</h2>

<p>这是一个字典（或哈希图）文件。</p>

<p>该文件描述为：</p>

<h3 id="宣布">宣布</h3>

<p>跟踪器的URL。还记得我们与跟踪服务器联系以使用同一文件查找其他对等节点时的情况吗？我们通过使用torrent描述符文件中的announce键找到了该跟踪器。</p>

<h3 id="信息">信息</h3>

<p>这映射到一个字典，该字典的键取决于是否共享一个或多个文件。关键是：</p>

<h4 id="文件-信息的子级-是列表">文件（信息的子级，是列表）</h4>

<p>文件仅在共享多个文件时存在。文件是词典列表。每个字典对应一个文件。
这些词典中的每一个都有2个键。</p>

<h4 id="长度-文件大小-以字节为单位">长度-文件大小，以字节为单位。</h4>

<p>路径 - 对应于子目录名称的字符串列表，最后一个是实际文件名。</p>

<p>长度 - 文件大小（以字节为单位）（仅在共享一个文件时）</p>

<p>名称 - 建议的文件名。或建议的目录名称。</p>

<p>件长-每块的字节数。</p>

<p>片段的长度必须是2的幂且至少为16KiB。</p>

<p>这是</p>

<p>件
哈希列表。</p>

<p>根据各种数据块计算得出的哈希列表。我们将数据分成几部分。计算这些片段的哈希值，并将其存储在列表中。</p>

<p>BitTorrent使用SHA-1，该SHA-1返回一个160位的哈希。片段将是一个长度为20个字节的倍数的字符串。</p>

<p>如果种子文件包含多个文件，则通过按文件在文件目录中出现的顺序串联文件来形成片段。</p>

<p>洪流中的所有片段均为完整片段长度，最后一个片段可能较短。</p>

<p>现在，我可以猜到您在想什么。</p>

<p>“ SHA-1？这是什么？2000年代初期？”
并且我同意。BitTorrent正在从SHA-1移至SHA256。</p>

<p>还是很困惑？不用担心！我设计了这个JSON文件，描述了种子文件的外观。注意：我已经连接了一些东西。这使得更容易阅读和理解总体布局。我按照BitTorrent的torrent描述符的规则编造了数字。</p>

<pre><code>{
    &quot;Announce&quot;: &quot;url of tracker&quot;,
    &quot;Info&quot;: {
        &quot;Files&quot;: [
            {
                &quot;Length&quot;: 16,
                &quot;path&quot;: &quot;/folder/to/path&quot;
            },
            {
                &quot;length&quot;: 193,
                &quot;path&quot;: &quot;/another/folder&quot;
            }
        ]
    },
    &quot;length&quot;: 192,
    &quot;name&quot;:&quot; Ubuntu.iso&quot;,
    &quot;Pieces length&quot;: 262144,
    &quot;Pieces&quot;: [AAF4C61DDCC5E8A2DABEDE0F3B482CD9AEA9434D, CFEA2496442C091FDDD1BA215D62A69EC34E94D0]
}
</code></pre>

</article>



</body>

</html>
